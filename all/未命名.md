```mermaid
graph TD
    %% 状态节点定义
    A[KEY_STATE_IDLE] -->|检测有效电平| B[KEY_STATE_DEBOUNCE]
    B -->|消抖成功| C[KEY_STATE_PRESSED]
    C -->|释放且未长按| A
    C -->|持续1秒| D[KEY_STATE_LONG_PRESSED]
    D -->|释放按键| A
    C -->|释放且clickCount=1| E[KEY_STATE_WAIT_DOUBLE]
    E -->|超时300ms| A
    E -->|二次按下| B

    %% 严格遵循您的配色规范
    style A fill:#DCE6F1,stroke:#AAB8C5,stroke-width:2px  %% 核心状态-浅蓝灰
    style B fill:#E3F4F9,stroke:#A2C3CD,stroke-width:2px  %% 次级状态-浅青色
    style C fill:#E3F4F9,stroke:#A2C3CD,stroke-width:2px
    style D fill:#E3F4F9,stroke:#A2C3CD,stroke-width:2px
    style E fill:#E3F4F9,stroke:#A2C3CD,stroke-width:2px

    %% 连线样式优化
    linkStyle 0,1,2,3,4,5,6 stroke:#606060,stroke-width:1.5px
    linkStyle 0,1,5,6 stroke-dasharray:0
    linkStyle 2,3,4 stroke-dasharray:5,5  %% 虚线表示条件分支

    %% 防止重叠的布局指令
    classDef keyState fill:#E3F4F9,stroke:#A2C3CD;
    class B,C,D,E keyState;
```